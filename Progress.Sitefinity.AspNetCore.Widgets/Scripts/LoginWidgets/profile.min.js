document.addEventListener("DOMContentLoaded", (function () { var e = document.querySelector("input[name='ViewMode']").value, t = document.querySelector("[data-sf-visibility-hidden]"), a = t.dataset ? t.dataset.sfVisibilityHidden : null, r = document.querySelector('[data-sf-role="read-container"]'), n = document.querySelector('[data-sf-role="form-container"]'), o = document.querySelector('[data-sf-role="error-message-container"]'), i = document.querySelector('[data-sf-role="success-message-container"]'), l = n.querySelector("input[name='InvalidPhotoErrorMessage']").value, u = n.querySelector("input[name='InvalidPasswordErrorMessage']").value, s = function (e) { e && (a ? e.classList.remove(a) : e.style.display = "") }, c = function (e) { e && (a ? e.classList.add(a) : e.style.display = "none") }, d = function (e) { window.location = e }; switch (e) { case "Edit": p(), s(n), c(r); break; case "Read": y(e), s(r), c(n); break; case "ReadEdit": y(e), p(), s(r), c(n) }var f = function () { c(o), s(i) }, m = function () { c(o), c(i) }, v = function (e, t) { e && (t ? o.innerHTML = e : o.innerText = e), o.innerText && (c(i), s(o)) }; function p(e) { var t, a = document.querySelector('[data-sf-role="form-container"]'), n = a.querySelector("form"), i = document.querySelector('[data-sf-role="edit-profile-upload-picture-input"]'), l = document.querySelector('[data-sf-role="sf-user-profile-avatar"]'), p = document.querySelector("[data-sf-invalid]"), y = p.dataset && (t = p.dataset.sfInvalid) && "" !== t ? p.dataset.sfInvalid : null, S = y ? y.split(" ") : null, E = "data-sf-invalid", w = !1, g = a.querySelector("input[name='InvalidEmailErrorMessage']").value, h = a.querySelector("input[name='ValidationRequiredMessage']").value; n.addEventListener("submit", (function (e) { if (e.preventDefault(), m(), b(n)) { var t = a.querySelector("input[name='InitialEmail']").value, r = n.querySelector("input[name='Email']").value; if (w || (n.querySelector("input[name='Password']").value = ""), t != r && !w) return m(), c(document.querySelector('[data-sf-role="edit-profile-container"]')), s(document.querySelector('[data-sf-role="password-container"]')), void (w = !0); new Promise(((e, t) => { let a = new XMLHttpRequest; a.open("GET", "/sitefinity/anticsrf"), a.setRequestHeader("X-SF-ANTIFORGERY-REQUEST", "true"), a.responseType = "json", a.onload = function () { const t = a.response; if (null != t) { const a = t.Value; document.querySelectorAll("input[name = 'sf_antiforgery']").forEach((e => e.value = a)), e() } else e() }, a.onerror = function () { t() }, a.send() })).then((e => { b(n) && T(n, null, k, M) }), (e => { v("Antiforgery token retrieval failed") })) } })), i.addEventListener("change", (function (e) { if (e.target.files && e.target.files[0]) { var t = new FileReader; t.onload = function (e) { l.src = e.target.result }, t.readAsDataURL(e.target.files[0]) } })); var b = function (e) { var t = !0; if (A(e), c(o), e.querySelectorAll("input[data-sf-role='required']").forEach((function (e) { e.value || (R(e), t = !1) })), !t) return v(h), t; var a = e.querySelector("input[name='Email']"); return L(a.value) ? !(i.files.length > 0 && !q(i.files[0])) && t : (R(a), v(g), !1) }, L = function (e) { return /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w+)+$/.test(e) }, R = function (e) { e && (S && e.classList.add(...S), e.setAttribute(E, "")) }, A = function (e) { e.querySelectorAll(`[${E}]`).forEach((function (e) { S && e.classList.remove(...S), e.removeAttribute(E) })) }, T = function (e, t, r, n) { t = t || e.attributes.action.value; for (var o = new FormData, i = 0; i < e.elements.length; i++) { var l = e.elements[i]; "submit" !== l.type && ("file" !== l.type ? o.append(l.name, l.value) : o.append("image", l.files[0])) } window.fetch(t, { method: "POST", body: o }).then((e => { var t = e.status; 0 === t || t >= 200 && t < 400 ? r && r(e) : e.json().then((e => { var a = e.error.message, r = e.error.fieldsErrors; n && n(a, r, t) })) })).finally((() => { w && (a.querySelector("input[name=Password]").value = "", s(document.querySelector('[data-sf-role="edit-profile-container"]')), c(document.querySelector('[data-sf-role="password-container"]')), w = !1) })) }, k = function (e) { switch (a.querySelector("input[name='PostUpdateAction']").value) { case "ViewMessage": !function (e) { e.json().then((e => { var t = e.value; a.querySelector("input[name='FirstName']").value = t.FirstName, a.querySelector("input[name='LastName']").value = t.LastName, a.querySelector("input[name='Email']").value = t.Email, a.querySelector("input[name='Nickname']").value = t.Nickname, a.querySelector("textarea[name='About']").value = t.About; var r = a.querySelector("img[data-sf-role='sf-user-profile-avatar']"); r.src = t.AvatarUrl, r.alt = t.Email, a.querySelector("input[name='InitialEmail']").value = t.Email })) }(e), c(o), f(); break; case "RedirectToPage": var t = a.querySelector("input[name='RedirectUrl']").value; d(t); break; case "SwitchToReadMode": c(a), s(r), d(window.location) } }, M = function (e, t, r) { 403 === r && (e = u); var n = []; e && n.push(e), t && Object.keys(t).forEach((e => { var r = a.querySelector("input[name='" + e + "']") ?? a.querySelector("img[name='" + e + "']"); if (r) if (R(r), r.id) { var o = a.querySelector("label[for='" + r.id + "']").innerText; n.push(t[e].replace("{0}", o)) } else n.push(t[e]) })), v(n.join("<br />"), !0) } } function y(e) { "ReadEdit" === e && document.querySelector('[data-sf-role="editProfileLink"]').addEventListener("click", (function (e) { e.preventDefault(), c(r), s(n) })) } function q(e) { var t = e.size, a = 26214400, r = n.querySelector('input[data-sf-role="sf-allowed-avatar-formats"]').value, o = e.name, i = o.substr(o.lastIndexOf(".")).toLowerCase(); return !(t > a || !r.split(",").map((e => e.trim())).includes(i)) || (v(l.replace("{0}", a).replace("{1}", r)), !1) } }));
