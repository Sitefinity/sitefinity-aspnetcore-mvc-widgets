var delayTimer,hiddenDataAttr="data-sf-hidden";function init(e){if(e&&"widgetLoaded"===e.type){var t=e.detail.element.querySelector("[data-sf-role='form-container']");t&&initFields(t)}else document.querySelectorAll("[data-sf-role='form-container']").forEach(function(e){initFields(e)})}function getInvalidClass(){var e=document.querySelector("[data-sf-invalid]"),t=e.dataset?e.dataset.sfInvalid:null;return t?processCssClass(t):null}function processCssClass(e){return e.split(" ")}function getVisibilityHidden(){var e=document.querySelector("[data-sf-visibility-hidden]");return e.dataset?e.dataset.sfVisibilityHidden:null}function getVisibilityClassVisible(){var e=document.querySelector("[data-sf-visibility-visible]");return e.dataset?e.dataset.sfVisibilityVisible:null}function getVisibilityClassInlineVisible(){var e=document.querySelector("[data-sf-visibility-inline-visible]");return e.dataset?e.dataset.sfVisibilityInlineVisible:null}function toggleShowStyles(e,t=!0){var i=getVisibilityClassVisible();t?("none"===e.style.display&&(e.style.display=""),i?e.classList.add(i):e.style.display="block"):i?e.classList.remove(i):e.style.display=""}function toggleShowInlineStyles(e,t=!0){var i=getVisibilityClassInlineVisible();t?("none"===e.style.display&&(e.style.display=""),i?e.classList.add(i):e.style.display="inline-block"):i?e.classList.remove(i):e.style.display=""}function toggleHideStyles(e,t=!0){var i=getVisibilityHidden();t?(i?e.classList.add(i):e.style.display="none",e.setAttribute(hiddenDataAttr,"")):(i?e.classList.remove(i):e.style.display="",e.removeAttribute(hiddenDataAttr))}function initFields(e){initTextbox(e),initParagraph(e),initSubmit(e),initMultipleChoice(e),initCheckboxes(e),initDropdown(e),initFileField(e),formHiddenFieldsInitialization(e),processFormRules(e,!0)}function dispatchValueChanged(e){clearTimeout(delayTimer),delayTimer=setTimeout(function(){"function"==typeof sfFormValueChanged&&sfFormValueChanged(e.srcElement)},300)}document.removeEventListener("widgetLoaded",init),document.addEventListener("widgetLoaded",init);var shouldScrollToFirstErrorField=!1;function initTextbox(e){initTextField("text-field-container","text-field-input",e)}function initParagraph(e){initTextField("paragraph-text-field-container","paragraph-text-field-textarea",e)}function initMultipleChoice(e){initChoiceField("multiple-choice-field-container","multiple-choice-field-input",e)}function initCheckboxes(e){initChoiceField("checkboxes-field-container","checkboxes-field-input",e)}function initSubmit(e){var t=e.querySelector('[data-sf-role="success-message"]'),i=e.querySelector('[data-sf-role="error-message"]'),n=e.querySelector('[data-sf-role="loading"]'),r=e.querySelector('[data-sf-role="fields-container"]'),o=e.querySelector('[data-sf-role="custom-submit-action"]')?.value,a=e.querySelector('[data-sf-role="redirect-url"]')?.value,l=e.querySelector('[data-sf-role="skip-data-submission"]'),s=e.closest("form"),u=e.querySelectorAll('[data-sf-role="submit-button-container"] button');function d(e){i.innerText=e,toggleShowStyles(i),toggleShowStyles(n,!1),toggleHideStyles(n),toggleHideStyles(r,!1),toggleShowStyles(r)}function c(e,i){e?document.location.replace(e):(i&&(t.innerText=i),toggleShowStyles(n,!1),toggleHideStyles(n),toggleShowStyles(t))}u.forEach(e=>e.addEventListener("click",function(e){shouldScrollToFirstErrorField=!0})),s.onsubmit=function(e){e?.preventDefault();var u=e.target.querySelectorAll('[data-sf-role*="field-container"'),f=!0;if(Array.from(u).filter(e=>!e.hasAttribute(hiddenDataAttr)).forEach(e=>{var t=e.getAttribute("data-sf-role"),i=!0;switch(t){case"file-field-container":i=handleFileValidation(e);break;case"text-field-container":case"paragraph-text-field-container":i=handleTextValidation(e);break;case"multiple-choice-field-container":i=handleChoiceValidation(e,"multiple-choice-field-input");break;case"checkboxes-field-container":i=handleChoiceValidation(e,"checkboxes-field-input");break;case"dropdown-list-field-container":i=handleDropdownValidation(e)}f=f&&i}),!f)return!1;if(toggleShowStyles(i,!1),toggleHideStyles(n,!1),toggleShowStyles(n),toggleShowStyles(t),toggleShowStyles(r,!1),toggleHideStyles(r),l)return c(a),!1;var g="X-SF-ANTIFORGERY-REQUEST",h={};return h[g]="",fetch("/sitefinity/anticsrf",{headers:h}).then(function(e){function t(e){e&&(h[g]=e);var t=new FormData(s);t.set("sf_antiforgery",e),fetch(s.getAttribute("action"),{method:"POST",body:t}).then(function(e){e.json().then(function(t){e.status>=200&&e.status<300?t.success?"True"===o?c(a):c(t.redirectUrl,t.message):d(t.error):e.status>=400&&e.status<600&&d(t.error)},function(e){d("Form submit response was not in json format and could not be parsed")})},function(e){d(JSON.stringify(e))})}200===e.status?e.json().then(function(e){t(e.Value)}):204===e.status?t():d("Failed to submit form due to lack of csrf token")}),!1}}function initChoiceField(e,t,i){i.querySelectorAll(`[data-sf-role='${e}']`).forEach(e=>{var i=e.querySelectorAll(`[data-sf-role='${t}']`);i.forEach(function(t){handleRequiredChoice(e,i),t.addEventListener("change",function(){i.forEach(function(e){clearErrorMessage(e)}),toggleOtherChoiceInputVisibility(e),handleRequiredChoice(e,i)}),t.addEventListener("input",onInput)}),addOtherChoiceInputsEventListener(e)})}function toggleOtherChoiceInputVisibility(e){var t=e.querySelector("[id*='choiceOption-other']"),i=e.querySelector("[data-sf-role='choice-other-input']");if(i){if(clearErrorMessage(i),t.checked){var n=t.required||e.querySelector('[data-sf-role="required-validator"]')?.value==="True";i.required=n,toggleHideStyles(i,!1),toggleShowStyles(i)}else i.required=!1,toggleShowStyles(i,!1),toggleHideStyles(i)}}function addOtherChoiceInputsEventListener(e){var t=e.querySelector("[id*='choiceOption-other']"),i=e.querySelector("[data-sf-role='choice-other-input']");i&&i.addEventListener("input",function(){t.setAttribute("value",i.value),clearErrorMessage(i)})}function handleRequiredChoice(e,t){var i=e.querySelector('[data-sf-role="required-validator"]');if(i){var n="True"===i.value;Array.from(t).find(e=>e.checked)||!n?t.forEach(e=>{e.removeAttribute("required")}):t.forEach(e=>{e.setAttribute("required","required")})}}function initDropdown(e){e.querySelectorAll('[data-sf-role="dropdown-list-field-container"]').forEach(e=>{var t=e.querySelector('[data-sf-role="dropdown-list-field-select"]');t.addEventListener("change",handleDropdownValidation),t.addEventListener("input",onInput)})}function initFileField(e){var t=e.querySelectorAll('[data-sf-role="file-field-container"]');if(t&&!(t.length<1))for(var i=0;i<t.length;i++){var n=t[i];if(n.querySelector('[data-sf-role="file-input-template"]')){var r=n.querySelector('[data-sf-role="file-input-template"]').innerHTML;a(r,n),l(r,n)}}function o(e){var t=e.querySelectorAll('[data-sf-role="remove-input"]'),i=!1;t.length>1&&(i=!0);for(let n=0;n<t.length;n++){let r=t[n];i?(toggleHideStyles(r,!1),toggleShowInlineStyles(r)):(toggleHideStyles(r),toggleShowInlineStyles(r,!1))}}function a(e,t){var i=t.querySelector('[data-sf-role="file-field-inputs"]');let n=document.createElement("div");n.innerHTML=e;let r=n.firstElementChild;i.appendChild(r),o(i);let a=r.querySelector('input[type="file"]'),l=r.querySelector('[data-sf-role="remove-input"]');l&&l.addEventListener("click",function(e){e.preventDefault(),a.removeEventListener("change",handleFileValidation),a.removeEventListener("input",onInput),a.removeEventListener("invalid",handleFileValidation),r.remove(),o(i)}),a.addEventListener("change",handleFileValidation),a.addEventListener("input",onInput),a.addEventListener("invalid",handleFileValidation)}function l(e,t){JSON.parse(t.querySelector('[data-sf-role="violation-restrictions"]').value).allowMultiple&&t.querySelector('[data-sf-role="add-input"]').addEventListener("click",function(i){i.preventDefault(),a(e,t)})}}function initTextField(e,t,i){for(var n=getInputs(e,t,i),r=0;r<n.length;r++)n[r].addEventListener("change",handleTextValidation),n[r].addEventListener("input",function(e){handleTextValidation(e),dispatchValueChanged(e)}),n[r].addEventListener("invalid",handleTextValidation)}function getInputs(e,t,i){var n=i.querySelectorAll(`[data-sf-role="${e}"]`),r=[];if(n&&n.length>0)for(var o=0;o<n.length;o++){var a=n[o].querySelectorAll(`[data-sf-role="${t}"]`);a&&!(a.length<1)&&r.push(...a)}return r}function onInput(e){clearErrorMessage(e.target),dispatchValueChanged(e)}function handleChoiceValidation(e,t){var i=findFieldContainerElement(e),n=i.querySelectorAll(`[data-sf-role='${t}']`),r=i.querySelector("[data-sf-role='choice-other-input']"),o=!1;n.forEach(function(e){o=o||e.checked}),n.forEach(function(e){clearErrorMessage(e)});var a=getValidationMessages(n[0]);return!o&&n[0].required?(setErrorMessage(n[0],a.required,!1,!1),!1):(r&&clearErrorMessage(r),!r||!r.required||!r.validity.valueMissing||(setErrorMessage(r,a.required),!1))}function handleTextValidation(e){e instanceof Event&&(e=e.target);var t=findFieldContainerElement(e),i=t.querySelector("input[data-sf-role='text-field-input']")||t.querySelector("textarea[data-sf-role='paragraph-text-field-textarea']"),n=getValidationMessages(i),r=getValidationRestrictions(i);if(r){var o=i.value.length>=r.minLength;if(r.maxLength>0&&(o&=i.value.length<=r.maxLength),!(o=o||0===i.value.length))return setErrorMessage(i,n.invalidLength,!0),!1}return i.required&&i.validity.valueMissing?(setErrorMessage(i,n.required,!0),!1):i.validity.patternMismatch?(setErrorMessage(i,n.regularExpression,!0),!1):i.validity.valid?(clearErrorMessage(i,!0),!0):(setErrorMessage(i,n.invalid,!0),!1)}function handleFileValidation(e){var t=getInvalidClass();e instanceof Event&&(e=e.target);var i=findFieldContainerElement(e),n=i.querySelectorAll('input[type="file"]'),r=getValidationRestrictions(e);if(r.required){for(var o=i.querySelector('[data-sf-role="required-violation-message"]'),a=null,l=0;l<n.length;l++){var s=n[l].closest('[data-sf-role="single-file-input-wrapper"]').querySelector('[data-sf-role="filesize-violation-message"]'),u=n[l].closest('[data-sf-role="single-file-input-wrapper"]').querySelector('[data-sf-role="filetype-violation-message"]');s&&toggleShowStyles(s,!1),u&&toggleShowStyles(u,!1),toggleShowStyles(o,!1),t&&n[l].classList.remove(...t),n[l].value&&(a=!0)}if(!a){if(t)for(var l=0;l<n.length;l++)n[l].classList.add(...t);return toggleShowStyles(o),!1}}if(r.maxSize||r.minSize){if(void 0===window.File||void 0===window.FileList)return!0;for(var d=!1,c=1e6*r.minSize,f=1e6*r.maxSize,l=0;l<n.length;l++)if(n[l].files.length>0){var g=n[l].files[0],s=n[l].closest('[data-sf-role="single-file-input-wrapper"]').querySelector('[data-sf-role="filesize-violation-message"]');if(c>0&&g.size<c||f>0&&g.size>f){toggleShowStyles(s),d=!0,n[l].focus();continue}toggleShowStyles(s,!1)}if(d)return!1}if(r.allowedFileTypes){for(var d=!1,l=0;l<n.length;l++){var h=n[l].closest('[data-sf-role="single-file-input-wrapper"]').querySelector('[data-sf-role="filetype-violation-message"]');if(n[l].value){var p=n[l].value.lastIndexOf(".");if(p>=0){var m=n[l].value.substring(p).toLowerCase();if(0>r.allowedFileTypes.indexOf(m)){toggleShowStyles(h),d=!0,n[l].focus();continue}toggleShowStyles(h,!1)}}}if(d)return!1}return!0}function handleDropdownValidation(e){e instanceof Event&&(e=e.target);var t=findFieldContainerElement(e).querySelector("select[data-sf-role='dropdown-list-field-select']");if(t.required&&""===t.value){var i=getValidationMessages(t);return setErrorMessage(t,i.required,!0),!1}return clearErrorMessage(t,!0),!0}function getValidationMessages(e){return getHiddenFieldValue(e,"violation-messages")}function getValidationRestrictions(e){return getHiddenFieldValue(e,"violation-restrictions")}function getHiddenFieldValue(e,t){var i=getHiddenField(e,t);return i?JSON.parse(i.value):null}function setErrorMessage(e,t,i=!1,n=!0){var r=getInvalidClass(),o=getErrorMessageContainer(e);o?(o.innerText=t,n&&r&&e.classList.add(...r),i||toggleShowStyles(o)):e.setCustomValidity(t),shouldScrollToFirstErrorField&&(shouldScrollToFirstErrorField=!1,e.parentNode.scrollIntoView())}function clearErrorMessage(e,t){var i=getInvalidClass(),n=getErrorMessageContainer(e);n&&(n.innerText="",i&&e.classList.remove(...i),t||toggleShowStyles(n,!1))}function findFieldContainerElement(e){for(var t=e;;){if(t.hasAttribute("data-sf-role")){let i=t.getAttribute("data-sf-role");if(-1!==i.indexOf("field-container"))break}t=t.parentElement}return t}function getErrorMessageContainer(e){return getHiddenField(e,"error-message")}function getHiddenField(e,t){var i=findFieldContainerElement(e);if(i){var n=i.querySelector(`[data-sf-role="${t}"]`);if(n)return n}return null}var FormRulesSettings=function(){var e=[],t=[],i=[],n=[],r=[];function o(e,t){this.name=e,this.conditionEvaluator=t}function a(e,t,i,n){this.inputType=e,this.parser=t,this.escape=i,this.escapeRegEx=n||/[\-\[\]{}()*+?.,\\\^$|#\s]/g}function l(e,t,i){this.fieldContainerDataSfRole=e,this.elementSelector=t,this.additionalFilter=i}return o.prototype.canProcess=function(e){return e===this.name},o.prototype.process=function(e,n,r){if(!t||0===t.length)return!1;for(var o,a,l=0;l<t.length;l++)(0===l||t[l].canParse(r))&&(o=t[l]);for(var s=0;s<i.length;s++)(0===s||i[s].canParse(r))&&(a=i[s]);var u=o?o.parse(e):e,d=a?a.parse(n):n;return this.conditionEvaluator(u,d)},a.prototype.canParse=function(e){return this.inputType===e},a.prototype.parse=function(e){var t=this.parser(e);return!0===this.escape&&"string"==typeof t?t.replace(this.escapeRegEx,"\\$&"):t},l.prototype.getFieldContainerDataSfRole=function(){return this.fieldContainerDataSfRole},l.prototype.getFieldValues=function(e){var t=this.elementSelector;this.additionalFilter&&(t+=this.additionalFilter);var i=e.querySelectorAll(t),n=[];return i.forEach(e=>{var t=e?.value?.replace(/^\s+|\s+$/g,"");n.push(t)}),n},l.prototype.getFieldValueElements=function(e){return e.querySelector(this.elementSelector)},l.prototype.canGetValues=function(e){return this.fieldContainerDataSfRole===e.getAttribute("data-sf-role")},{addConditionEvaluator:function(t,i){e.push(new o(t,i))},removeConditionEvaluator:function(t){for(var i=0;i<e.length;i++)if(e[i].name===t){e.splice(i,1);break}},processConditionEvaluator:function(t,i,n,r){for(var o=0;o<e.length;o++)if(e[o].canProcess(t))return e[o].process(n,r,i);return!1},getConditionEvaluator:function(t){for(var i=0;i<e.length;i++)if(e[i].canProcess(t))return e[i];return null},addActionExecutor:function(e,t){r.push({actionName:e,actionExecutor:t})},removeActionExecutor:function(e){r=r.filter(function(t){return t.actionName!==e})},getActionExecutor:function(e){var t=r.filter(function(t){return t.actionName===e})[0];return t?t.actionExecutor:null},addInputTypeParser:function(e,i,n,r){t.push(new a(e,i,n,r))},removeInputTypeParser:function(e){for(var i=0;i<t.length;i++)if(t[i].inputType===e){t.splice(i,1);break}},addRuleValueParser:function(e,t,n,r){i.push(new a(e,t,n,r))},removeRuleValueParser:function(e){for(var t=0;t<i.length;t++)if(i[t].inputType===e){i.splice(t,1);break}},addFieldSelector:function(e,t,i){if(n.map(function(e){return e.fieldContainerDataSfRole}).indexOf(e)>-1)throw"Container with attribute [data-sf-role='"+e+"'] have been registered already.";n.push(new l(e,t,i))},removeFieldSelector:function(e){for(var t=0;t<n.length;t++)if(n[t].fieldContainerDataSfRole===e){n.splice(t,1);break}},getFieldValues:function(e){for(var t=0;t<n.length;t++)if(n[t].canGetValues(e))return n[t].getFieldValues(e);return[]},getFieldValueElements:function(e){for(var t=0;t<n.length;t++)if(n[t].canGetValues(e))return n[t].getFieldValueElements(e);return null},getFieldsContainerNames:function(){for(var e=[],t=0;t<n.length;t++)e.push(n[t].getFieldContainerDataSfRole());return e}}}(),FormRuleConstants={Actions:{Show:"Show",Hide:"Hide",Skip:"Skip",ShowMessage:"ShowMessage",GoTo:"GoTo",SendNotification:"SendNotification"}};function FormRuleActionExecutorBase(){}function HideShowFieldFormRuleActionExecutor(e){if(FormRuleActionExecutorBase.call(this),e===FormRuleConstants.Actions.Show||e===FormRuleConstants.Actions.Hide)this.actionName=e;else throw Error("Invalid action name! Only "+FormRuleConstants.Actions.Show+" and "+FormRuleConstants.Actions.Hide+" action names are allowed")}function SkipToPageFormRuleActionExecutor(){FormRuleActionExecutorBase.call(this)}function ShowMessageRuleActionExecutor(){FormRuleActionExecutorBase.call(this)}function GoToPageRuleActionExecutor(){FormRuleActionExecutorBase.call(this)}function SendNotificationRuleActionExecutor(){FormRuleActionExecutorBase.call(this)}function formHiddenFieldsInitialization(e){var t=e.querySelector('[data-sf-role="form-rules-hidden-fields"]');if(t){var i=t.value;i&&i.split(",").forEach(t=>{var i=e.querySelector('script[data-sf-role="start_field_'+t+'"]');if(i){var n=i.getAttribute("data-sf-role-field-name"),r=i.querySelector('[name="'+n+'"]');r&&r.setAttribute("disabled","disabled");for(var o=i.nextElementSibling;!o.matches('script[data-sf-role="end_field_'+t+'"]');)toggleShowStyles(o,!1),toggleHideStyles(o),o=o.nextElementSibling}})}"function"==typeof processFormRules&&processFormRules(e);var n=e.closest('[data-sf-role="form-visibility-wrapper"]');n&&(Array.from(n.children).forEach(e=>{n.parentElement.insertBefore(e,n)}),n.remove())}FormRuleActionExecutorBase.prototype.applyState=function(e,t){throw Error("applyState() function not implemented")},FormRuleActionExecutorBase.prototype.updateState=function(e,t){throw Error("updateState() function not implemented")},FormRuleActionExecutorBase.prototype.undoUpdateState=function(e,t){throw Error("undoUpdateState() function not implemented")},FormRuleActionExecutorBase.prototype.isConflict=function(e,t){return!1},FormRuleActionExecutorBase.prototype.getActionFieldIds=function(e){return[]},HideShowFieldFormRuleActionExecutor.prototype=Object.create(FormRuleActionExecutorBase.prototype),HideShowFieldFormRuleActionExecutor.prototype.constructor=HideShowFieldFormRuleActionExecutor,HideShowFieldFormRuleActionExecutor.prototype.applyState=function(e,t){var i=e.helper.fieldIndexOf(e.fields,t.target),n=e.fields[i].FieldControlId;e.fields[i].Visible?e.helper.showField(e,n):e.helper.hideField(e,n)},HideShowFieldFormRuleActionExecutor.prototype.updateState=function(e,t){var i=!1,n=e.helper.fieldIndexOf(e.fields,t.target);return this.actionName!==FormRuleConstants.Actions.Show||e.fields[n].Visible?this.actionName===FormRuleConstants.Actions.Hide&&e.fields[n].Visible&&(e.fields[n].Visible=!1,i=!0):(e.fields[n].Visible=!0,i=!0),i},HideShowFieldFormRuleActionExecutor.prototype.undoUpdateState=function(e,t){var i=e.helper.fieldIndexOf(e.fields,t.target);this.actionName===FormRuleConstants.Actions.Show?e.fields[i].Visible=!1:e.fields[i].Visible=!0},HideShowFieldFormRuleActionExecutor.prototype.isConflict=function(e,t){return(t.name===FormRuleConstants.Actions.Show||t.name===FormRuleConstants.Actions.Hide)&&e.target===t.target},HideShowFieldFormRuleActionExecutor.prototype.getActionFieldIds=function(e){return[e.target]},SkipToPageFormRuleActionExecutor.prototype=Object.create(FormRuleActionExecutorBase.prototype),SkipToPageFormRuleActionExecutor.prototype.constructor=SkipToPageFormRuleActionExecutor,SkipToPageFormRuleActionExecutor.prototype.applyState=function(e,t){e.skipToPageCollection&&e.formContainer.trigger("form-page-skip",[e.skipToPageCollection])},SkipToPageFormRuleActionExecutor.prototype.updateState=function(e,t){return e.skipToPageCollection||(e.skipToPageCollection=[]),t.pageIndex<parseInt(t.target)&&(e.skipToPageCollection.push({SkipFromPage:t.pageIndex,SkipToPage:parseInt(t.target)}),!0)},SkipToPageFormRuleActionExecutor.prototype.undoUpdateState=function(e,t){e.skipToPageCollection&&(e.skipToPageCollection=e.skipToPageCollection.filter(function(e){return e.SkipFromPage!==t.pageIndex||e.SkipToPage!==parseInt(t.target)}))},SkipToPageFormRuleActionExecutor.prototype.isConflict=function(e,t){return e.name===t.name&&e.pageIndex===t.pageIndex},ShowMessageRuleActionExecutor.prototype=Object.create(FormRuleActionExecutorBase.prototype),ShowMessageRuleActionExecutor.prototype.constructor=ShowMessageRuleActionExecutor,ShowMessageRuleActionExecutor.prototype.applyState=function(e,t){var i=e.formContainer.querySelector('[data-sf-role="form-rules-message"]');i&&(this.execute?i.value=t.target:i.value===t.target&&(i.value=""))},ShowMessageRuleActionExecutor.prototype.updateState=function(e,t){return this.execute=!0,!0},ShowMessageRuleActionExecutor.prototype.undoUpdateState=function(e,t){this.execute=!1},ShowMessageRuleActionExecutor.prototype.isConflict=function(e,t){return t.name===FormRuleConstants.Actions.ShowMessage||t.name===FormRuleConstants.Actions.GoTo},GoToPageRuleActionExecutor.prototype=Object.create(FormRuleActionExecutorBase.prototype),GoToPageRuleActionExecutor.prototype.constructor=GoToPageRuleActionExecutor,GoToPageRuleActionExecutor.prototype.applyState=function(e,t){var i=e.formContainer.querySelector('[data-sf-role="form-rules-redirect-page"]');i&&(this.execute?i.value=t.target:i.value===t.target&&(i.value=""))},GoToPageRuleActionExecutor.prototype.updateState=function(e,t){return this.execute=!0,!0},GoToPageRuleActionExecutor.prototype.undoUpdateState=function(e,t){this.execute=!1},GoToPageRuleActionExecutor.prototype.isConflict=function(e,t){return t.name===FormRuleConstants.Actions.ShowMessage||t.name===FormRuleConstants.Actions.GoTo},SendNotificationRuleActionExecutor.prototype=Object.create(FormRuleActionExecutorBase.prototype),SendNotificationRuleActionExecutor.prototype.constructor=SendNotificationRuleActionExecutor,SendNotificationRuleActionExecutor.prototype.applyState=function(e,t){var i=e.formContainer.querySelector('[data-sf-role="form-rules-notification-emails"]');i&&(e.notificationEmails?i.value=e.notificationEmails.join(","):i.value="")},SendNotificationRuleActionExecutor.prototype.updateState=function(e,t){return e.notificationEmails||(e.notificationEmails=[]),-1===e.notificationEmails.indexOf(t.target)&&e.notificationEmails.push(t.target),!0},SendNotificationRuleActionExecutor.prototype.undoUpdateState=function(e,t){if(e.notificationEmails){var i=e.notificationEmails.indexOf(t.target);-1!==i&&e.notificationEmails.splice(i,0)}},SendNotificationRuleActionExecutor.prototype.isConflict=function(e,t){return e.name===t.name&&e.target===t.target},function e(){FormRulesSettings.addConditionEvaluator("Equal",function(e,t){return"string"==typeof e?0===e.search(RegExp("^"+t+"$","i")):e===t}),FormRulesSettings.addConditionEvaluator("NotEqual",function(e,t){return"string"==typeof e?-1===e.search(RegExp("^"+t+"$","i")):e!==t}),FormRulesSettings.addConditionEvaluator("Contains",function(e,t){return e.search(RegExp(t,"i"))>-1}),FormRulesSettings.addConditionEvaluator("NotContains",function(e,t){return -1===e.search(RegExp(t,"i"))});var t=function(e){return("number"!=typeof e||e==e)&&e&&e.toString().length>0};FormRulesSettings.addConditionEvaluator("IsFilled",t),FormRulesSettings.addConditionEvaluator("IsNotFilled",function(e){return!t(e)}),FormRulesSettings.addConditionEvaluator("FileSelected",function(e){return e&&e.length>0}),FormRulesSettings.addConditionEvaluator("FileNotSelected",function(e){return!e||0===e.length}),FormRulesSettings.addConditionEvaluator("IsGreaterThan",function(e,t){return e>t}),FormRulesSettings.addConditionEvaluator("IsLessThan",function(e,t){return e<t})}(),function e(){var t=function(e){var t=new Date(e);return new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()},i=function(e,t){var i=new Date(e);return t&&i.setTime(i.getTime()+t),new Date(i.getFullYear(),i.getMonth()).getTime()},n=function(e){var t=new Date(parseInt(e.split(["-W"])[0]),0,1+(parseInt(e.split(["-W"])[1])-1)*7);return t.setDate(t.getDate()-t.getDay()+(4>=t.getDate()?1:8)),t.getTime()},r=function(e,t){var i=new Date(e),n=new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes());return t&&(n=new Date(n.getTime()+t)),n.getTime()},o=function(e,t){var i=new Date(e);return t&&(i=new Date(i.getTime()+t)),60*i.getHours()+i.getMinutes()};FormRulesSettings.addInputTypeParser("text",function(e){return e}),FormRulesSettings.addInputTypeParser("month",function(e){return i(e,6e4*new Date(e).getTimezoneOffset())}),FormRulesSettings.addInputTypeParser("number",function(e){return parseFloat(e)&&Number(e)}),FormRulesSettings.addInputTypeParser("datetime-local",r),FormRulesSettings.addInputTypeParser("date",t),FormRulesSettings.addInputTypeParser("time",function(e){return 60*parseInt(e.split([":"])[0])+parseInt(e.split([":"])[1])}),FormRulesSettings.addInputTypeParser("week",n),FormRulesSettings.addRuleValueParser("text",function(e){return e},!0),FormRulesSettings.addRuleValueParser("month",function(e){return i(e,6e4*new Date(e).getTimezoneOffset())}),FormRulesSettings.addRuleValueParser("number",function(e){return parseFloat(e)&&Number(e)}),FormRulesSettings.addRuleValueParser("datetime-local",function(e){return r(e,6e4*new Date(e).getTimezoneOffset())}),FormRulesSettings.addRuleValueParser("date",t),FormRulesSettings.addRuleValueParser("time",function(e){return o(e,6e4*new Date(e).getTimezoneOffset())}),FormRulesSettings.addRuleValueParser("week",n)}(),FormRulesSettings.addFieldSelector("text-field-container","[data-sf-role='text-field-input']"),FormRulesSettings.addFieldSelector("email-text-field-container","[data-sf-role='email-text-field-input']"),FormRulesSettings.addFieldSelector("multiple-choice-field-container","[data-sf-role='multiple-choice-field-input']",":checked"),FormRulesSettings.addFieldSelector("checkboxes-field-container","[data-sf-role='checkboxes-field-input']",":checked"),FormRulesSettings.addFieldSelector("paragraph-text-field-container","[data-sf-role='paragraph-text-field-textarea']"),FormRulesSettings.addFieldSelector("dropdown-list-field-container","[data-sf-role='dropdown-list-field-select']"),FormRulesSettings.addFieldSelector("file-field-container","[data-sf-role='single-file-input'] input[type='file']"),function e(){var t=new HideShowFieldFormRuleActionExecutor(FormRuleConstants.Actions.Hide);FormRulesSettings.addActionExecutor(FormRuleConstants.Actions.Hide,t);var i=new HideShowFieldFormRuleActionExecutor(FormRuleConstants.Actions.Show);FormRulesSettings.addActionExecutor(FormRuleConstants.Actions.Show,i);var n=new SkipToPageFormRuleActionExecutor;FormRulesSettings.addActionExecutor(FormRuleConstants.Actions.Skip,n);var r=new ShowMessageRuleActionExecutor;FormRulesSettings.addActionExecutor(FormRuleConstants.Actions.ShowMessage,r);var o=new GoToPageRuleActionExecutor;FormRulesSettings.addActionExecutor(FormRuleConstants.Actions.GoTo,o);var a=new SendNotificationRuleActionExecutor;FormRulesSettings.addActionExecutor(FormRuleConstants.Actions.SendNotification,a)}(),function(){"use strict";var e=new Map,t=function(e){this._init(e)};t.prototype={_init:function(e){this.fieldContainerSelector='[data-sf-role$="field-container"]',this.separatorSelector='[data-sf-role="separator"]',this.formContainerSelector=r(),this.skipFieldsSelector='input[type="hidden"][data-sf-role="form-rules-skip-fields"]',this.hiddenFieldsSelector='input[type="hidden"][data-sf-role="form-rules-hidden-fields"]',this.formContainer=e.closest(this.formContainerSelector);var t=e.closest(this.separatorSelector);this.fieldsContainer=t||this.formContainer,this.pages=Array.from(this.formContainer.querySelectorAll(this.separatorSelector)),this._initializeFormRules(),this.iterationsMaxCount=50;var i=this;this.formContainer.addEventListener("form-page-changed",function(e,t,n){i._updateSkipPages(n,t)})},process:function(){if(this._hasRules()){this.hiddenFields=this._getHiddenFields(),this.skipFields=this._getSkipFields();var e=this._contextInitialization(),t=this._evaluateFormRules(e);this._applyActionsState(t),this.hiddenFields=t.hiddenFields,this._setHiddenFields(this.hiddenFields),this._setExecutedActions(t.activeActions)}},_hasRules:function(){return this.formRules&&0!==this.formRules.length},_evaluateFormRules:function(e){var t=e.fields.map(function(e){return e.Visible}),i=this._updateContext(e),n=i.fields.map(function(e){return e.Visible}),r=this._compareArrays(t,n);return e.iterationsCounter>this.iterationsMaxCount||r?i:(e.iterationsCounter++,this._evaluateFormRules(i))},_updateContext:function(e){for(var t=this._getRulesActionsState(e),i=0;i<t.length;i++){var n=t[i],r=e.helper.actionItemIndexOf(e.activeActions,n.data);if(n.data.applyRule){var o=n.executor.updateState(e,n.data);-1===r&&o&&e.activeActions.push(n)}else r>-1&&(n.executor.undoUpdateState(e,n.data),e.activeActions.splice(r,1))}return e},_getRulesActionsState:function(e){for(var t=[],i=this,n=0;n<this.formRules.length;n++)for(var r=this.formRules[n],o=this._evaluateConditions(e,r),a=0;a<r.actions.length;a++)!function(e,t,n){var r=i._actionItemIndexOf(e,t.data);if(-1===r){if(n)for(var r=0;r<e.length;r++)!0===e[r].data.applyRule&&(e[r].data.applyRule=!e[r].executor.isConflict(e[r].data,t.data));t.data.applyRule=n,e.push(t)}else!1===e[r].data.applyRule&&(e[r].data.applyRule=n)}(t,r.actions[a],o);return t},_applyActionsState:function(e){for(var t=0;t<e.activeActions.length;t++){var i=e.activeActions[t];i.executor.applyState(e,i.data)}for(var n=e.executedActions.filter(function(t){return -1===e.activeActions.indexOf(t)}),r=0;r<n.length;r++){var o=n[r];o.executor.applyState(e,o.data)}},_evaluateConditions:function(e,t){for(var i,n=[],r=0;r<t.conditions.length;r++){var o=t.conditions[r],a=this._getContextField(e,o.data.id),l=this._getFieldType(o.data.id),s=!1;if(!0===a.Visible&&o.evaluator){if(a.Values&&a.Values.length>0)for(var u=0;u<a.Values.length&&!(s=o.evaluator.process(a.Values[u],o.data.value,l));u++);else s=o.evaluator.process(null,o.data.value,l)}n.push(s)}return"And"===t.operator?this._every(n,function(e){return e}):this._some(n,function(e){return e})},_initializeFormRules:function(){this.formRules=[];var e=this.formContainer.querySelector('input[data-sf-role="form-rules"]'),t=e&&e.value.length>0?JSON.parse(e.value):null;if(t)for(var i=0;i<t.length;i++){for(var n=t[i],r={operator:n.Operator,conditions:[],actions:[]},o=0,a=0;a<n.Conditions.length;a++){var l=n.Conditions[a],s=FormRulesSettings.getConditionEvaluator(l.Operator);r.conditions.push({data:{id:l.Id,value:l.Value},evaluator:s});var u=this._getFieldPageContainerIndex(l.Id);o=u&&u>o?u:o}for(var d=0;d<n.Actions.length;d++){var c=n.Actions[d],f=FormRulesSettings.getActionExecutor(c.Action);f&&r.actions.push({data:{target:c.Target,name:c.Action,pageIndex:o},executor:f})}r.actions=this._filterConflictingRuleActions(r.actions),this.formRules.push(r)}},_filterConflictingRuleActions:function(e){for(var t=[],i=e.length-1;i>=0;i--)0===t.filter(function(t){return e[i].executor.isConflict(e[i].data,t.data)}).length&&t.push(e[i]);return t.reverse()},_contextInitialization:function(){var e=this._getExecutedActions();return{fields:this._fieldsInitialization(),executedActions:e.slice(),activeActions:e.slice(),formContainer:this.formContainer,formContainerSelector:this.formContainerSelector,iterationsCounter:0,hiddenFields:this.hiddenFields,skipToPageCollection:[],helper:{showField:this._showField.bind(this),hideField:this._hideField.bind(this),getFieldElement:this._getFieldElement.bind(this),getFieldStartSelector:this._getFieldStartSelector.bind(this),getFieldEndSelector:this._getFieldEndSelector.bind(this),fieldIndexOf:this._fieldIndexOf.bind(this),arrayIndexOf:this._arrayIndexOf.bind(this),actionItemIndexOf:this._actionItemIndexOf.bind(this)}}},_fieldsInitialization:function(){for(var e=[],t=this._getFormRulesFields(),i=0;i<t.length;i++)e.push({FieldControlId:t[i],Values:this._getFieldValues(t[i]),Visible:-1===this._arrayIndexOf(this.hiddenFields,t[i])&&-1===this._arrayIndexOf(this.skipFields,t[i])});return e},_getFormRulesFields:function(){for(var e=[],t=0;t<this.formRules.length;t++){for(var i=0;i<this.formRules[t].conditions.length;i++){var n=this.formRules[t].conditions[i].data.id;-1===this._arrayIndexOf(e,n)&&e.push(n)}for(var r=0;r<this.formRules[t].actions.length;r++){var o=this.formRules[t].actions[r].executor.getActionFieldIds(this.formRules[t].actions[r].data);if(o&&o.length>0)for(var a=0;a<o.length;a++)-1===this._arrayIndexOf(e,o[a])&&e.push(o[a])}}return e},_updateSkipPages:function(e,t){if(e<t)for(var i=FormRulesSettings.getFieldsContainerNames(),n=e+1;n<t;n++)for(var r=0;r<i.length;r++)for(var o=this.pages.eq(n).find('[data-sf-role="'+i[r]+'"]'),a=0;a<o.length;a++){var l=FormRulesSettings.getFieldValueElements(o[a]);if(l.length){var s=l.first().setAttribute("name"),u=this.formContainer.querySelectorAll("script[data-sf-role-field-name='"+s+"']")[0];if(u){var d=u.getAttribute("data-sf-role");if(d){var c=d.replace("start_field_","");this._skipField(c)}}}}else for(var f=this.skipFields.length-1;f>=0;f--){var g=this._getFieldPageContainerIndex(this.skipFields[f]);t<g&&g<e&&this._unskipField(this.skipFields[f])}this._setSkipFields(this.skipFields)},_skipField:function(e){-1===this._arrayIndexOf(this.skipFields,e)&&(this.skipFields.push(e),this._getFieldElement(e).setAttribute("disabled","disabled"))},_unskipField:function(e){var t=this._arrayIndexOf(this.skipFields,e);t>-1&&(this.skipFields.splice(t,1),this._getFieldElement(e).removeAttribute("disabled"))},_actionItemIndexOf:function(e,t){for(var i=0;i<e.length;i++)if(e[i].data.target===t.target&&e[i].data.name===t.name&&e[i].data.pageIndex===t.pageIndex)return i;return -1},_getContextField:function(e,t){for(var i=0;i<e.fields.length;i++)if(e.fields[i].FieldControlId===t)return e.fields[i];return null},_getFieldElement:function(e){var t=this.formContainer.querySelector(this._getFieldStartSelector(e));if(t){for(var i=[],n=t.nextElementSibling;!n.matches(this._getFieldEndSelector(e));)i.push(n),n=n.nextElementSibling;var r=FormRulesSettings.getFieldsContainerNames();if(r&&r.length>0)for(var o=0;o<r.length;o++){var a='[data-sf-role="'+r[o]+'"]',l=null;for(let s=0;s<i.length;s++){var u=i[0];if(u.matches(a)){l=u;break}}if(!l)for(let d=0;d<i.length;d++){var u=i[0];if(u.querySelector(a)){l=u;break}}if(l)return FormRulesSettings.getFieldValueElements(l)}}return null},_showField:function(e,t){var i=this._arrayIndexOf(e.hiddenFields,t);if(i>-1){e.hiddenFields.splice(i,1);var n=e.formContainer.querySelector(this._getFieldStartSelector(t));if(n){var r=this._getFieldElement(t);r&&r.removeAttribute("disabled");for(var o=n.nextElementSibling;!o.matches(this._getFieldEndSelector(t));)toggleHideStyles(o,!1),toggleShowStyles(o),o=o.nextElementSibling}}},_hideField:function(e,t){if(-1===this._arrayIndexOf(e.hiddenFields,t)){e.hiddenFields.push(t);var i=e.formContainer.querySelector(this._getFieldStartSelector(t));if(i){var n=this._getFieldElement(t);n&&n.setAttribute("disabled","disabled");for(var r=i.nextElementSibling;!r.matches(this._getFieldEndSelector(t));)toggleShowStyles(r,!1),toggleHideStyles(r),r=r.nextElementSibling}}},_getFieldType:function(e){var t=this._getFieldElement(e),i=null;return!t||(i=t.getAttribute("data-sf-input-type"))||(i=this._getFieldElement(e).getAttribute("type")),i},_getFieldValues:function(e){var t=this._getFieldContainer(e);return FormRulesSettings.getFieldValues(t)},_getFieldContainer:function(e){return this._getFieldElement(e).closest(this.fieldContainerSelector)},_getFieldPageContainer:function(e){var t=this._getFieldElement(e);return t.closest(this.separatorSelector)||t.closest(this.formContainerSelector)},_getFieldPageContainerIndex:function(e){var t=this._getFieldPageContainer(e);return this.pages.findIndex(function(e){return e===t})},_fieldIndexOf:function(e,t){for(var i=0;i<e.length;i++)if(e[i].FieldControlId===t)return i;return -1},_getExecutedActions:function(){return e.get(this.formContainer)||[]},_setExecutedActions:function(t){e.set(this.formContainer,t)},_getHiddenFields:function(){var e=this.formContainer.querySelector(this.hiddenFieldsSelector);return e?this._createArrayFromCsvValue(e.value):[]},_setHiddenFields:function(e){var t=this.formContainer.querySelector(this.hiddenFieldsSelector);t&&(t.value=e.join(","))},_getSkipFields:function(){var e=this.formContainer.querySelector(this.skipFieldsSelector);return e?this._createArrayFromCsvValue(e.value):[]},_setSkipFields:function(e){this.formContainer.querySelector(this.skipFieldsSelector).value=e.join(",")},_createArrayFromCsvValue:function(e){for(var t=(e||"").split(","),i=[],n=0;n<t.length;n++)t[n]&&""!==t[n]&&i.push(t[n]);return i},_arrayIndexOf:function(e,t){for(var i=0;i<e.length;i++)if(e[i]===t)return i;return -1},_compareArrays:function(e,t){var i=e.length;if(i!==t.length)return!1;for(;i--;)if(e[i]!==t[i])return!1;return!0},_some:function(e,t){for(var i=0;i<e.length;i++)if(t(e[i]))return!0;return!1},_every:function(e,t){for(var i=0;i<e.length;i++)if(!t(e[i]))return!1;return!0},_getFieldStartSelector:function(e){return'script[data-sf-role="start_field_'+e+'"]'},_getFieldEndSelector:function(e){return'script[data-sf-role="end_field_'+e+'"]'}};var i=[];function n(e,n){if(e){var r=null,o=i.filter(function(t){return t.formContainer===e})[0];!0!==n&&o?r=o.formRulesExecutor:(r=new t(e),!0===n&&(i=i.filter(function(e){return e.formContainer!==o.formContainer})),i.push({formContainer:e,formRulesExecutor:r})),r.process()}}function r(){var e='[data-sf-role="form-container"]';let t=document.querySelectorAll(e);return t.length>0?e:null}window.processFormRules=n,window.sfFormValueChanged=function(e){n(e.closest(r()),!1)}}(),init(null);